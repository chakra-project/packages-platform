# $Id: PKGBUILD 61846 2009-12-26 20:27:23Z andyrtr $
# Maintainer: Jan de Groot <jgc@archlinux.org>
# Contributor: Alexander Baldeck <alexander@archlinux.org>

pkgname=xf86-video-ati
#_gitdate=20091221
#pkgver=6.12.99.git${_gitdate} # see configure.ac
pkgver=6.12.4
pkgrel=3
pkgdesc="X.org ati video driver"
arch=(i686 x86_64)
url="http://xorg.freedesktop.org/"
license=('custom')
depends=('libdrm>=2.4.17-2' 'libpciaccess' 'ati-dri>=7.7' 'pixman>=0.16.4')
makedepends=('pkgconfig' 'xorg-server>=1.7.3.902' 'fontsproto'
	     'glproto>=1.4.10' 'xf86driproto' 'diffutils' 'xorg-util-macros' 'xineramaproto' 'mesa>=7.7')
conflicts=('xorg-server<1.7.0')
groups=('xorg-video-drivers')
options=('!libtool' 'force')
source=(${url}/releases/individual/driver/${pkgname}-${pkgver}.tar.bz2
	#ftp://ftp.archlinux.org/other/$pkgname/xf86-video-ati-${_gitdate}.tar.bz2
	git_fixes.patch
	LICENSE)
md5sums=('e662348f6f957fcedf52818d668ab9f5'
         'f4f0fd376b02dde282d97ce9744b7795'
         '75da66945980a43adf1e1856271b9d4a')

build() {
  # get git code
#  cd ${srcdir}
#  git clone -v git://anongit.freedesktop.org/xorg/driver/xf86-video-ati
#  cd xf86-video-ati
#  git archive --prefix=xf86-video-ati-${_gitdate}/ --format=tar HEAD | bzip2 > ../../xf86-video-ati-${_gitdate}.tar.bz2
#  return 1

  cd "${srcdir}/${pkgname}-${pkgver}"
  # add commits until 20091226 from 6.12 branch
  patch -Np1 -i $srcdir/git_fixes.patch || return 1
#  cd "${srcdir}/${pkgname}"*
#  ./autogen.sh --prefix=/usr --enable-dri || return 1
  ./configure --prefix=/usr --enable-dri || return 1
  make || return 1
  make "DESTDIR=${pkgdir}" install || return 1
  install -D -m644 "${srcdir}/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
